# render.yaml — Render Deployment Blueprint
# Uses your existing Supabase PostgreSQL database.
#
# How to use:
#  1. Push this repo to GitHub / GitLab.
#  2. Render dashboard → New → Blueprint → connect your repo.
#  3. After first deploy, go to your service's Environment tab and set
#     all variables marked with sync: false.

services:
  - type: web
    name: pagepilot
    runtime: docker
    plan: free            # upgrade when ready
    region: oregon
    branch: main

    envVars:
      - key: DEBUG
        value: "False"

      - key: ALLOWED_HOSTS
        value: ".onrender.com"

      - key: CSRF_TRUSTED_ORIGINS
        value: "https://pagepilot-btwt.onrender.com"

      - key: SECRET_KEY
        generateValue: true

      # ── Supabase Database ──────────────────────────────────────────
      # Paste your full Supabase connection string in the Render dashboard.
      # Format: postgresql://postgres:<PASSWORD>@db.<ref>.supabase.co:5432/postgres
      - key: DATABASE_URL
        sync: false       # set manually in Render dashboard (contains your password)

      # ── Email ─────────────────────────────────────────────────────
      - key: EMAIL_HOST
        value: smtp.gmail.com
      - key: EMAIL_PORT
        value: "587"
      - key: EMAIL_HOST_USER
        sync: false
      - key: EMAIL_HOST_PASSWORD
        sync: false
      - key: DEFAULT_FROM_EMAIL
        sync: false

      # ── Site info ─────────────────────────────────────────────────
      - key: SITE_NAME
        value: "Page Pilot"
      - key: SITE_URL
        value: "https://pagepilot-btwt.onrender.com"

      - key: API_ADMIN_PASSWORD
        sync: false

    healthCheckPath: /accounts/login/
